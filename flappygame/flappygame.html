<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird Clone</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; background: #70c5ce; }
    #gameCanvas { display: block; background: #70c5ce; }
    #ui { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); color: white; font-size: 28px; text-shadow: 1px 1px 2px #000; }
    #startBtn, #restartBtn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 16px 32px; font-size: 28px; background: #ffd700; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui"></div>
  <button id="startBtn">Start</button>
  <button id="restartBtn" style="display:none;">Restart</button>
  <script>
    // Canvas Setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const ui = document.getElementById('ui');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    let W, H;
    function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    // Game Constants
    const FIRST_PIPE_FRAME = 30;
    const SPAWN_INTERVAL = 200;
    const INITIAL_GAP = 400;
    const MIN_GAP = 120;
    const GAP_DECREMENT = 20;
    const BASE_SPEED = 3;
    const SPEED_INCREMENT = 0.5;

    // Game Variables
    let bird, pipes, score, frame, highScore, pipesSpawned;
    let gameState = 'MENU';

    // Bird Class
    class Bird {
      constructor() {
        this.x = W * 0.2;
        this.y = H / 2;
        this.radius = 50;
        this.velocity = 0;
        this.gravity = 0.3;
        this.lift = -8;
      }
      update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        if (this.y + this.radius > H) { this.y = H - this.radius; this.velocity = 0; }
        if (this.y - this.radius < 0) { this.y = this.radius; this.velocity = 0; }
      }
      flap() { this.velocity = this.lift; }
      draw() {
        // body
        ctx.fillStyle = '#ffeb3b'; ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2); ctx.fill();
        // wing
        ctx.fillStyle = '#fdd835'; ctx.beginPath(); ctx.ellipse(this.x, this.y+5, this.radius*0.6, this.radius*0.3, Math.PI/4, 0, Math.PI*2); ctx.fill();
        // beak
        ctx.fillStyle = '#fb8c00'; ctx.beginPath(); ctx.moveTo(this.x+this.radius, this.y); ctx.lineTo(this.x+this.radius+12, this.y-6); ctx.lineTo(this.x+this.radius+12, this.y+6); ctx.closePath(); ctx.fill();
        // eye
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(this.x+this.radius*0.4, this.y-this.radius*0.3, this.radius*0.12, 0, Math.PI*2); ctx.fill();
      }
    }

    // Pipe Class
    class Pipe {
      constructor(gap, speed) {
        this.gap = gap;
        this.top = Math.random() * (H - gap - 100) + 50;
        this.bottom = this.top + gap;
        this.x = W;
        this.w = 120;
        this.speed = speed;
        this.scored = false;
      }
      update() { this.x -= this.speed; }
      offscreen() { return this.x + this.w < 0; }
      hits(b) {
        return b.x + b.radius > this.x && b.x - b.radius < this.x + this.w && (b.y - b.radius < this.top || b.y + b.radius > this.bottom);
      }
      draw() { ctx.fillStyle = '#4caf50'; ctx.fillRect(this.x, 0, this.w, this.top); ctx.fillRect(this.x, this.bottom, this.w, H - this.bottom); }
    }

    // High Score Storage
    function loadHighScore() { highScore = parseInt(localStorage.getItem('highScore')) || 0; }
    function saveHighScore() { localStorage.setItem('highScore', highScore); }

    // Spawn a pipe, dynamic gap and speed
    function spawnPipe(initial = false) {
      const gap = Math.max(MIN_GAP, INITIAL_GAP - GAP_DECREMENT * Math.floor(pipesSpawned / 10));
      const speed = BASE_SPEED + SPEED_INCREMENT * Math.floor(pipesSpawned / 5);
      const pipe = new Pipe(gap, speed);
      if (initial) pipe.x = W * 0.6;
      pipes.push(pipe);
      pipesSpawned++;
    }

    // Reset Game
    function resetGame() {
      bird = new Bird();
      pipes = [];
      pipesSpawned = 0;
      score = 0;
      frame = 0;
      ui.textContent = '';
      spawnPipe(true);
    }

    // Update Game State
    function updateGame() {
      frame++;
      bird.update();
      if (frame === FIRST_PIPE_FRAME) spawnPipe();
      if (frame > FIRST_PIPE_FRAME && (frame - FIRST_PIPE_FRAME) % SPAWN_INTERVAL === 0) spawnPipe();

      pipes.forEach(pipe => {
        pipe.update();
        if (!pipe.scored && pipe.x + pipe.w < bird.x) { score++; pipe.scored = true; }
        if (pipe.hits(bird)) gameState = 'GAMEOVER';
      });

      pipes = pipes.filter(pipe => !pipe.offscreen());
      if (bird.y + bird.radius >= H || bird.y - bird.radius <= 0) gameState = 'GAMEOVER';
      ui.textContent = `Score: ${score} | High Score: ${highScore}`;
    }

    // Draw Everything
    function drawGame() {
      ctx.clearRect(0, 0, W, H);
      bird.draw();
      pipes.forEach(pipe => pipe.draw());
    }

    // Main Loop
    function loop() {
      if (gameState === 'PLAYING') { updateGame(); drawGame(); requestAnimationFrame(loop); }
      else if (gameState === 'GAMEOVER') {
        if (score > highScore) { highScore = score; saveHighScore(); }
        ui.textContent = `Game Over! Score: ${score} | High Score: ${highScore}`;
        restartBtn.style.display = 'block';
      }
    }

    // Input Handling
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        if (gameState === 'PLAYING') bird.flap();
        else if (gameState === 'MENU') startGame();
        else if (gameState === 'GAMEOVER') restartGame();
      }
    });
    canvas.addEventListener('mousedown', () => { if (gameState === 'PLAYING') bird.flap(); });

    // Game Flow Controls
    function startGame() { startBtn.style.display = 'none'; restartBtn.style.display = 'none'; loadHighScore(); resetGame(); gameState = 'PLAYING'; loop(); }
    function restartGame() { restartBtn.style.display = 'none'; resetGame(); gameState = 'PLAYING'; loop(); }
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', restartGame);

    // Initialize
    loadHighScore();
  </script>
</body>
</html>
